-------- Recreate Deployment Strategy --------

## Step 5: Create Recreate Deployment YAML

```bash
vi recreate.yaml
```

Add content:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 4
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: nginx
        image: nginx:1.25.3
        ports:
        - containerPort: 80
```

---

## Step 6: Apply Recreate Deployment

```bash
kubectl apply -f recreate.yaml
```

Verify pods:

```bash
kubectl get pods
```

---

## Step 7: Update Image in Recreate Deployment

Edit file:

```bash
vi recreate.yaml
```

Change image:

```text
nginx:1.25.3 â†’ nginx:latest
```

Apply changes:

```bash
kubectl apply -f recreate.yaml
```

Verify new pods:

```bash
kubectl get pods
```

---

## Step 8: Delete Recreate Deployment

```bash
kubectl delete -f recreate.yaml
```

Confirm deletion:

```bash
kubectl get pods
```

## 1ï¸âƒ£ Recreate Deployment Strategy Diagram

```
USER
 â”‚
 â”‚ Request
 â–¼
SERVICE
 â”‚
 â”‚  (Old Pods Deleted First)
 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod v1 (nginx:1.25.3)      â”‚   âŒ TERMINATED
â”‚  Pod v1 (nginx:1.25.3)      â”‚   âŒ TERMINATED
â”‚  Pod v1 (nginx:1.25.3)      â”‚   âŒ TERMINATED
â”‚  Pod v1 (nginx:1.25.3)      â”‚   âŒ TERMINATED
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â›” APPLICATION DOWNTIME

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod v2 (nginx:latest)      â”‚   âœ… CREATED
â”‚  Pod v2 (nginx:latest)      â”‚   âœ… CREATED
â”‚  Pod v2 (nginx:latest)      â”‚   âœ… CREATED
â”‚  Pod v2 (nginx:latest)      â”‚   âœ… CREATED
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸ”´ **Downtime occurs because no pods are running during update**

After that copy the node server public IP with port no 
eg. - <public IP>:<port no>
        172.91.75.3:32278

result: nginx


---------  Rolling Update Deployment Strategy -----------



## Step 9: Create Rolling Deployment YAML

```bash
vi rolling.yaml
```

Add content:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 4
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
```

---

## Step 10: Apply Rolling Deployment

```bash
kubectl apply -f rolling.yaml
```

Verify pods:

```bash
kubectl get pods -o wide
```

---

## Step 11: Update Image in Rolling Deployment

Edit file:

```bash
vi rolling.yaml
```

Change image:

```text
nginx â†’ httpd
```

Change replicas:

```text
4 â†’ 10
```

Apply update:

```bash
kubectl apply -f rolling.yaml
```

Verify rolling update:

```bash
kubectl get pods
```

---

## Step 12: Delete Rolling Deployment

```bash
kubectl delete -f rolling.yaml
```

Confirm deletion:

```bash
kubectl get pods
```

## 2ï¸âƒ£ Rolling Update Deployment Strategy Diagram

```
USER
 â”‚
 â”‚ Request
 â–¼
SERVICE
 â”‚
 â”‚ Traffic Distributed
 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pod v1       â”‚   â”‚ Pod v2       â”‚
â”‚ nginx        â”‚   â”‚ httpd        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚
        â”‚  Gradual Replace â”‚
        â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pod v2       â”‚   â”‚ Pod v2       â”‚
â”‚ httpd        â”‚   â”‚ httpd        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸŸ¢ **No downtime because old and new pods run together**

After that copy the node server public IP with port no 
eg. - <public IP>:<port no>
        172.91.75.3:32278

result: nginx / httpd 


-------  Blue-Green Deployment Strategy --------



## Step 13: Create Blue Deployment

```bash
vi blue-green-deployment-bluereplica-v2.yaml
```

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: blue-myapp
spec:
  replicas: 2
  selector:
    matchLabels:
      app: myapp
      replica: blue
  template:
    metadata:
      labels:
        app: myapp
        replica: blue
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
```

Apply:

```bash
kubectl apply -f blue-green-deployment-bluereplica-v2.yaml
```

---

## Step 14: Create Green Deployment

```bash
vi blue-green-deployment-greenreplica-v1.yaml
```

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: green-myapp
spec:
  replicas: 2
  selector:
    matchLabels:
      app: myapp
      replica: green
  template:
    metadata:
      labels:
        app: myapp
        replica: green
    spec:
      containers:
      - name: nginx
        image: httpd
        ports:
        - containerPort: 80
```

Apply:

```bash
kubectl apply -f blue-green-deployment-greenreplica-v1.yaml
```

---

## Step 15: Create Blue-Green Service

```bash
vi blue-green-service.yaml
```

```yaml
apiVersion: v1
kind: Service
metadata:
  name: myapp
spec:
  type: NodePort
  selector:
    app: myapp
    replica: blue
  ports:
  - port: 80
    targetPort: 80
```

Apply:

```bash
kubectl apply -f blue-green-service.yaml
```

---

## Step 16: Switch Traffic from Blue to Green

Edit service:

```bash
vi blue-green-service.yaml
```

Change selector:

```text
replica: blue â†’ replica: green
```

Apply:

```bash
kubectl apply -f blue-green-service.yaml
```

Verify:

```bash
kubectl describe svc myapp
```

---

## Step 17: Delete Blue-Green Resources

```bash
kubectl delete -f .
```

## 3ï¸âƒ£ Blue-Green Deployment Strategy Diagram

```
                        USER
                         â”‚
                         â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ SERVICE  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                 â”‚
        â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BLUE Deployment  â”‚             â”‚ GREEN Deployment â”‚
â”‚ nginx            â”‚             â”‚ httpd            â”‚
â”‚ replica=blue     â”‚             â”‚ replica=green    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Traffic Switch

```
Before Switch:
Service Selector â†’ replica=blue

After Switch:
Service Selector â†’ replica=green
```

ğŸ”µ **Instant switch and instant rollback**

After that copy the node server public IP with port no 
eg. - <public IP>:<port no>
        172.91.75.3:30752



--------  Canary Deployment Strategy --------


## Step 18: Create Canary v1 Deployment

```bash
vi canary-v1-deployment.yaml
```

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: canary-demo-v1-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: canary-demo
  template:
    metadata:
      labels:
        app: canary-demo
    spec:
      containers:
      - name: app
        image: nginx
        ports:
        - containerPort: 3000
```

Apply:

```bash
kubectl apply -f canary-v1-deployment.yaml
```

---

## Step 19: Create Canary v2 Deployment

```bash
vi canary-v2-deployment.yaml
```

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: canary-demo-v2-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: canary-demo
  template:
    metadata:
      labels:
        app: canary-demo
    spec:
      containers:
      - name: app
        image: httpd
        ports:
        - containerPort: 3000
```

Apply:

```bash
kubectl apply -f canary-v2-deployment.yaml
```

---

## Step 20: Create Canary Service

```bash
vi canary-service.yaml
```

```yaml
apiVersion: v1
kind: Service
metadata:
  name: canary-service
spec:
  type: NodePort
  selector:
    app: canary-demo
  ports:
  - port: 3000
    targetPort: 3000
```

Apply:

```bash
kubectl apply -f canary-service.yaml
```

---

## Step 21: Cleanup Canary Resources

```bash
kubectl delete -f .
```

Verify cleanup:

```bash
kubectl get pods
```
---

## 4ï¸âƒ£ Canary Deployment Strategy Diagram

```
                          USER
                           â”‚
                           â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  SERVICE   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                             â”‚
            â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v1 Deployment      â”‚       â”‚ v2 Deployment      â”‚
â”‚ Stable Version     â”‚       â”‚ Canary Version     â”‚
â”‚ nginx              â”‚       â”‚ httpd              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸŸ¡ **Small percentage of traffic goes to Canary (v2)**
ğŸŸ¢ **If stable â†’ increase traffic**
ğŸ”´ **If error â†’ rollback instantly**

---

## Diagram Summary Table

| Strategy   | Downtime | Traffic Control | Rollback Speed |
| ---------- | -------- | --------------- | -------------- |
| Recreate   | Yes      | None            | Slow           |
| Rolling    | No       | Automatic       | Medium         |
| Blue-Green | No       | Manual Switch   | Instant        |
| Canary     | No       | Gradual         | Fast           |

---


